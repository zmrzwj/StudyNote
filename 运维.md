## 一、自动化部署

## 1、jenkins

### 1.1 安装：

(包地址：https://pkg.jenkins.io/)

wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key
yum install jenkins
或 
wget https://pkg.jenkins.io/redhat/jenkins-2.156-1.1.noarch.rpm
rpm -ivh jenkins-2.156-1.1.noarch.rpm
修改端口：
vim /etc/sysconfig/jenkins
JENKINS_PORT="8080"
修改用户为root：
vim /etc/sysconfig/jenkins
#修改配置
$JENKINS_USER="root"
启动
systemctl start jenkins
（报错没有java ,  ln -s /usr/local/java/bin/java /usr/bin/java）
访问：
http://xxxx:8080
查看初始密码:
cat /var/lib/jenkins/secrets/initialAdminPassword
汉化：
系统管理 -> 系统设置 -> Locale
若修改为中文简体，Default Language设置为：
zh_cn

jenkins插件下载源修改：
系统管理-》插件管理-》高级-》升级站点
官方地址：https://updates.jenkins.io/update-center.json
清华地址：https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json

### 1.2、重启Jenkins

http://192.168.11.206:8080/jenkins/restart

### 1.3、用户角色

安装插件	
Role-based Authorization Strategy
系统管理-》全局安全配置 -> 授权策略 -> Role-Based Strategy
系统管理-》Manage and Assign Roles

### 1.4、访问git问题

git版本过老需要升级
/usr/bin/git xxx报错，可能是安装时/usr/bin/下没有添加git，ln -s /usr/local/git/bin/git /usr/bin/git

### 1.5、maven项目

https://maven.apache.org/download.cgi
wget xxxx
解压后
vim  /etc/profile
export MAVEN_HOME=/usr/local/maven/
export PATH=${MAVEN_HOME}/bin:${PATH}
ln -s /usr/local/maven/bin/mvn /usr/bin/mvn

### 1.6、pipeline

声明式、脚本式
触发远程构建：
http://192.168.11.182:8080//job/pipeline_test/build?token=TOKEN_NAME（访问此连接就触发构建）
Build after other projects are built（其它项目构建后）
Build periodically 定时构建
Poll SCM 轮询
	设定日期拉取代码，代码有改变才会构建
GitHub hook trigger for GITScm polling
	github或gitlab需要安装相应的插件
添加参数：
	配置-》This project is parameterized -》 String Parameter 
	填写名称和默认值。如：名称：branch，默认：master
	（在项目这边就可以看到多了‘Build with Parameters’）
	在Jenkinsfile中修改字符串为${branch}的变量

### 1.7、整合邮箱

​	安装Email Extension Template
​	configure system -》 Extended E-mail Notification
​		填写相关信息：smtp.qq.com 开启ssl，端口为465
​	qq邮箱先开启stmp, 获取授权码：iymoiaxqfhptbdig
​	如果发送成功却收不到邮件，确定SMTP password是否正确。

### 1.8、代码审查

sonarQube
安装sonarQube，在mysql创建sonar数据库
https://www.sonarqube.org/downloads/
https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-8.8.0.42792.zip (sonarQube7.9起不再支持mysql, 且java为11)
unzip sonarqube-8.8.0.42792.zip
mv sonarqube-8.8.0.42792 /usr/local/sonarqube
useradd sonar
chown -R sonar /usr/local/sonarqube
cd /usr/local/sonarqube/conf
vim sonar.properties

sonar.jdbc.username=root

sonar.jdbc.password=uestc@123456

sonar.jdbc.url=jdbc:mysql://192.168.11.206:3306/sonar?useUnicode=true&characterEncoding=utf8&rewriteBatchedStatements=true&useConfigs=maxPerformance

sonar.web.host=0.0.0.0
su sonar （一定要切换到此用户才能启动）
cd /usr/local/sonarqube/bin/linux-x86-64
./sonar.sh start
tail -f logs/sonar.log
http://192.168.11.182:9000
默认：admin admin/ admin Admin12#$



jenkins安装[SonarQube Scanner]插件

Global Tool Configuration -》SonarQube Scanner

选择新增SonarQube Scanner，勾选Install automatically，选择最新的SonarQube Scanner，点击保存

configure system -》 SonarQube servers-》Add SonarQube

server url填写http://192.168.11.182:9000/，选择Server authentication token（没有要添加，添加方法如下）

​	添加全局凭证，类型为Secret text，添加SonarQube的token到Secret，

（SonarQube的token生成，my account-》security， aa752251325f1878d556bca448719e5340553664）



项目配置：

Add pre-build step-》Execute SonarQube Scanner

Task to run

```
scan
```

JDK

```
java11
```

Analysis properties

java代码：

```
sonar.projectKey = tomcat_test
sonar.projectName = tomcat_test
sonar.projectVersion = 1.0
sonar.sources = ./src/main/java/com/sccddw/msb/
sonar.exclusions = **/test/**, **/target/**
sonar.java.binaries = ./target/classes
sonar.java.source=1.11
sonar.sourceEncoding=UTF-8
```

前端代码：

```
sonar.projectKey=gitlab_test
sonar.projectName=gitlab_test
sonar.projectVersion=1.0
sonar.sources=src
sonar.language=js,ts
sonar.eslint.eslintconfigpath=.eslintrc
sonar.eslint.ruleconfigs=.eslintrc
sonar.sourceEncoding=UTF-8
sonar.exclusions=**/__test__/**,**/demo/**,**/*.bak.*,**/*.bak
```

（Global Tool Configuration-》JDK，别名：java11， JAVA_HOME：/usr/local/java）





2、travis ci




2、jenkins + docker + nexus(制品库)




3、ansible




4、kubernetes




5、sonar





6、jenkins X



7.drone CI